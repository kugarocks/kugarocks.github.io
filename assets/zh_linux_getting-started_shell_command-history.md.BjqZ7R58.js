import{_ as i,c as a,o as h,ah as e}from"./chunks/framework.D2ZEUu4m.js";const c=JSON.parse('{"title":"命令行历史记录","description":"","frontmatter":{},"headers":[],"relativePath":"zh/linux/getting-started/shell/command-history.md","filePath":"zh/linux/getting-started/shell/command-history.md","lastUpdated":1746806643000}'),t={name:"zh/linux/getting-started/shell/command-history.md"};function l(n,s,k,d,r,p){return h(),a("div",null,s[0]||(s[0]=[e('<h1 id="命令行历史记录" tabindex="-1">命令行历史记录 <a class="header-anchor" href="#命令行历史记录" aria-label="Permalink to “命令行历史记录”">​</a></h1><h2 id="神奇的-a" tabindex="-1">神奇的 ^[[A <a class="header-anchor" href="#神奇的-a" aria-label="Permalink to “神奇的 ^[[A”">​</a></h2><p>首先在命令行启动一个新 Shell <code>/bin/sh</code>。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/bin/sh</span></span></code></pre></div><p>然后输入以下命令，一切正常。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span></span></code></pre></div><p>按一下方向键 ⬆️ 查看上一条命令。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">^[[A</span></span></code></pre></div><p>你会发现看不到上一条命令，取而代之的是这几个字符 <code>^[[A</code>。 这是因为早期的 sh 并不支持查看命令的历史记录，直到 bash 才把这个功能加了上去。</p><h3 id="ansi-转义序列" tabindex="-1">ANSI 转义序列 <a class="header-anchor" href="#ansi-转义序列" aria-label="Permalink to “ANSI 转义序列”">​</a></h3><p><code>^[[A</code> 是一个 ANSI 的转义序列，表示上方向键。</p><ul><li><code>^[</code>：表示 <code>Esc</code> 键（ASCII 编码 27），是转义序列的开始。</li><li><code>[A</code>：表示具体的操作，<code>[A</code> 表示上方向键。</li></ul><p>当在终端中按下上方向键时，终端会发送 <code>^[[A</code> 这个字符序列给程序， 通常用于调用命令历史记录中的上一条命令。 由于 sh 并不支持查看命令的历史记录，它会原样输出键位的字符序列。</p><h3 id="ubuntu-中的-sh" tabindex="-1">Ubuntu 中的 sh <a class="header-anchor" href="#ubuntu-中的-sh" aria-label="Permalink to “Ubuntu 中的 sh”">​</a></h3><p>在 Ubuntu 中，sh 其实是一个指向 dash 的链接。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh</span></span></code></pre></div><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/bin/sh:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> symbolic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dash</span></span></code></pre></div><p>因此 dash 也不支持查看命令的历史记录。</p><h2 id="历史记录功能" tabindex="-1">历史记录功能 <a class="header-anchor" href="#历史记录功能" aria-label="Permalink to “历史记录功能”">​</a></h2><h3 id="history-命令" tabindex="-1">history 命令 <a class="header-anchor" href="#history-命令" aria-label="Permalink to “history 命令”">​</a></h3><p>不带参数会输出所有历史记录。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">history</span></span></code></pre></div><p>也可以使用简短命令，效果一样。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!!</span></span></code></pre></div><h3 id="bash-history-文件" tabindex="-1">.bash_history 文件 <a class="header-anchor" href="#bash-history-文件" aria-label="Permalink to “.bash_history 文件”">​</a></h3><p>命令历史记录的持久化文件。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-rw-------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kuga</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kuga</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5516</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 08:23</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/kuga/.bash_history</span></span></code></pre></div><p>在和 Shell 交互的过程中，命令的历史记录会被保存在内存里。 使用 <code>history</code> 命令可以实时查看历史记录的变化， 但只有当退出 Shell，历史记录才会被写入到 <code>.bash_history</code> 文件中。 如果想立刻写到历史记录的文件中，可以使用以下命令。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">history</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span></code></pre></div><h2 id="环境变量" tabindex="-1">环境变量 <a class="header-anchor" href="#环境变量" aria-label="Permalink to “环境变量”">​</a></h2><h3 id="histfile" tabindex="-1">HISTFILE <a class="header-anchor" href="#histfile" aria-label="Permalink to “HISTFILE”">​</a></h3><p>历史记录文件路径。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HISTFILE</span></span></code></pre></div><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/home/kuga/.bash_history</span></span></code></pre></div><h3 id="histfilesize" tabindex="-1">HISTFILESIZE <a class="header-anchor" href="#histfilesize" aria-label="Permalink to “HISTFILESIZE”">​</a></h3><p>历史记录文件大小。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HISTFILESIZE</span></span></code></pre></div><div class="language-txt"><button title="复制代码" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>2000</span></span></code></pre></div><h3 id="histsize" tabindex="-1">HISTSIZE <a class="header-anchor" href="#histsize" aria-label="Permalink to “HISTSIZE”">​</a></h3><p>内存中历史记录列表的大小。</p><div class="language-bash"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HISTSIZE</span></span></code></pre></div><div class="language-txt"><button title="复制代码" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>1000</span></span></code></pre></div>',42)]))}const b=i(t,[["render",l]]);export{c as __pageData,b as default};
