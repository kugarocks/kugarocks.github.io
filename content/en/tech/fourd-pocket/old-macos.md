---
title: "å®‰è£…æ—§ç‰ˆ macOS"
description: ""
summary: ""
date: 2024-08-02T00:00:00+08:00
lastmod: 2024-09-08T00:00:00+08:00
weight: 600
seo:
  title: "å®‰è£…æ—§ç‰ˆ macOS"
  description: ""
  canonical: ""
  noindex: false
---

## èƒŒæ™¯

å‡ºäºç§ç§åŸå› ï¼Œè¦åœ¨ä¸€å°è‹¹æœç”µè„‘ä¸Šå®‰è£…æ—§ç‰ˆæœ¬çš„ macOS æ˜¯ä¸€ä»¶ä¸å®¹æ˜“çš„äº‹ã€‚å› ä¸ºè‹¹æœå®˜ç½‘çš„ä¸‹è½½é“¾æ¥ä¼šå¼•å¯¼ä½ åˆ° App Storeï¼Œå½“å®ƒå‘ç°ä½ è¦ä¸‹è½½çš„ç³»ç»Ÿç‰ˆæœ¬æ¯”ä½ å½“å‰ä½¿ç”¨çš„ç³»ç»Ÿè¿˜è¦æ—§çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šæä¾›ä¸‹è½½çš„ï¼Œåªèƒ½ä¸‹è½½æ›´æ–°çš„ç‰ˆæœ¬ã€‚

å‰å‡ å¤©æˆ‘ä¸€ä¸ªæœ‹å‹åˆšé«˜ä¸­æ¯•ä¸šï¼Œå¤§å­¦æƒ³è¦å­¦è®¡ç®—æœºï¼Œæˆ‘å°±æ¨èä»–ä¹°è‹¹æœç”µè„‘ï¼Œä½†ä»–ä¹‹å‰éƒ½æ²¡ç”¨è¿‡ macOSï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—æŠŠæˆ‘é‚£å° 2014 å¹´çš„ MacBook Air ç»™ä»–ä½“éªŒä¸€ä¸‹ã€‚å½“æ—¶è¿™å°ç”µè„‘çš„ç³»ç»Ÿæ˜¯ High Sierra 10.13ï¼Œæˆ‘æƒ³ç€æä¸ª USB å¯åŠ¨ç›˜é‡è£…ä¸€ä¸‹ç³»ç»Ÿï¼Œé¡ºæ‰‹æŠŠç£ç›˜çš„æ•°æ®éƒ½æŠ¹æ‰ï¼Œæ²¡æƒ³åˆ°è¿™ä¸€é¡¿æ“ä½œä»¥åï¼Œæˆ‘äººéº»äº†ã€‚

## è¯ä¹¦è¿‡æœŸ

æˆ‘åœ¨ç½‘ä¸Šéšä¾¿æ‰¾äº†ä¸€ä¸ª High Sierra é•œåƒï¼Œå› ä¸ºè‹¹æœå®˜ç½‘æ ¹æœ¬ä¸‹è½½ä¸äº†æ—§ç‰ˆæœ¬çš„ macOSï¼Œå¼•å¯¼ç›˜åšå¥½äº†ä¹‹åï¼Œä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼Œç›´åˆ°å®ƒç»™æˆ‘æ¥äº†ä¸ªæƒŠå–œ ã€‚ï¼ˆè¿™ä¸ªå›¾æˆ‘æ˜¯ç½‘ä¸Šæ‰¾çš„ï¼‰

![macos-damaged](/images/misc/macos-damaged.jpg)

æŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œå¾ˆå¤šéƒ½è¯´æ˜¯è¯ä¹¦è¿‡æœŸçš„é—®é¢˜ï¼Œå› ä¸ºä»¥å‰è‹¹æœå‘å¸ƒçš„è¯ä¹¦æœ‰äº›æ˜¯åœ¨ 2019 å¹´è¿‡æœŸçš„ã€‚

![cert-info](/images/misc/cert-info.jpg)

## è§£å†³æ–¹æ¡ˆ

### ä¸‹è½½æœ€æ–°å®˜æ–¹é•œåƒï¼ˆæ¨èï¼‰

ä¸€ä¸ªé•œåƒèƒ½ä¸èƒ½ç”¨ä¸ä»…ä»…æ˜¯è¯ä¹¦çš„é—®é¢˜ï¼Œæ‰€ä»¥æœ€é è°±çš„æ–¹æ³•æ˜¯ä»è‹¹æœå®˜æ–¹ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…ã€‚ä½†å‰é¢è¯´äº† App Store æ ¹æœ¬ä¸æä¾›ä¸‹è½½ï¼Œå¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ `softwareupdate` è¿™ä¸ªå‘½ä»¤ï¼Œå»ä¸‹è½½å½“å‰ç”µè„‘æ‰€æ”¯æŒçš„ç³»ç»Ÿç‰ˆæœ¬ã€‚

```bash {frame="none"}
softwareupdate --list-full-installers
```

```bash {frame="none"}
Finding available software
Software Update found the following full installers:
* Title: macOS Sonoma, Version: 14.6, Size: 13339695KiB, Build: 23G80
* Title: macOS Sonoma, Version: 14.5, Size: 13353373KiB, Build: 23F79
* Title: macOS Sonoma, Version: 14.4.1, Size: 13298513KiB, Build: 23E224
* Title: macOS Ventura, Version: 13.6.8, Size: 11922165KiB, Build: 22G820
* Title: macOS Ventura, Version: 13.6.7, Size: 11924125KiB, Build: 22G720
* Title: macOS Ventura, Version: 13.6.6, Size: 11917983KiB, Build: 22G630
* Title: macOS Monterey, Version: 12.7.6, Size: 12118346KiB, Build: 21H1320
* Title: macOS Monterey, Version: 12.7.5, Size: 12116686KiB, Build: 21H1222
* Title: macOS Monterey, Version: 12.7.4, Size: 12117810KiB, Build: 21H1123
* Title: macOS Big Sur, Version: 11.7.10, Size: 12125478KiB, Build: 20G1427
* Title: macOS Catalina, Version: 10.15.7, Size: 8055650KiB, Build: 19H15
* Title: macOS Catalina, Version: 10.15.7, Size: 8055522KiB, Build: 19H2
* Title: macOS Catalina, Version: 10.15.6, Size: 8055450KiB, Build: 19G2021
* Title: macOS Mojave, Version: 10.14.6, Size: 5896894KiB, Build: 18G103
* Title: macOS Mojave, Version: 10.14.4, Size: 5894794KiB, Build: 18E2034
```

```bash {frame="none"}
softwareupdate --fetch-full-installer --full-installer-version 10.14.6
```

å› ä¸ºæˆ‘å¦ä¸€å°ç”µè„‘æ”¯æŒçš„æœ€æ—§ç‰ˆæœ¬æ˜¯ Mojaveï¼Œä¸æ˜¯ High Sierraï¼Œæ‰€ä»¥æœ€åæˆ‘å®‰è£…äº† 10.14.6ã€‚

### å®‰è£…æ—¶ä¿®æ”¹ç³»ç»Ÿæ—¶é—´

æ‰“å¼€ Utilities -> Terminalï¼Œä½¿ç”¨ `date` å‘½ä»¤ä¿®æ”¹æ—¶é—´ã€‚

```bash {frame="none"}
date 010101012018
```

![macos-terminal](/images/misc/macos-terminal.jpg)

## çŸ¥å…¶æ‰€ä»¥ç„¶

è™½ç„¶é—®é¢˜æ˜¯è§£å†³äº†ï¼Œä½†æˆ‘æ›´æƒ³éªŒè¯ä¸€ä¸‹åˆ°åº•æ˜¯ä¸æ˜¯è¯ä¹¦è¿‡æœŸçš„é—®é¢˜ã€‚

* High Sierraï¼šæŠ¥é”™ï¼Œapplication is damaged
* Mojaveï¼šæˆåŠŸå®‰è£…

è¿™ä¸¤ä¸ªå®‰è£…åŒ…éƒ½æ˜¯åç¼€ä¸º `.app` çš„æ–‡ä»¶ï¼ˆå…¶å®ä¹Ÿæ˜¯ç›®å½•ï¼‰ï¼Œä¸åƒä¸Šé¢çš„ `.pkg` æ–‡ä»¶ï¼Œç›´æ¥æ‰“å¼€å°±èƒ½çœ‹åˆ°è¯ä¹¦ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨åˆ«çš„æ–¹æ³•ã€‚

### æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `pkgutil` æŸ¥çœ‹ `.app` çš„è¯ä¹¦ä¿¡æ¯ã€‚

```bash {frame="none"}
pkgutil --check-signature Install\ macOS\ High\ Sierra.app
```

```bash {frame="none"}
Package "Install macOS High Sierra":
   Status: signed by untrusted certificate
   Certificate Chain:
    1. Software Signing
       SHA256 Fingerprint:
           2A A4 B9 97 3B 7B A0 7A DD 44 7E E4 DA 8B 53 37 C3 EE 2C 3A 99 19
           11 E8 0E 72 82 E8 A7 51 FC 32
       ------------------------------------------------------------------------
    2. Apple Code Signing Certification Authority
       Expires: 2026-10-24 17:39:41 +0000
       SHA256 Fingerprint:
           5B DA B1 28 8F C1 68 92 FE F5 0C 65 8D B5 4F 1E 2E 19 CF 8F 71 CC
           55 F7 7D E2 B9 5E 05 1E 25 62
       ------------------------------------------------------------------------
    3. Apple Root CA
       Expires: 2035-02-09 21:40:36 +0000
       SHA256 Fingerprint:
           B0 B1 73 0E CB C7 FF 45 05 14 2C 49 F1 29 5E 6E DA 6B CA ED 7E 2C
           68 C5 BE 91 B5 A1 10 01 F0 24
```

å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢çš„è¯ä¹¦ä¿¡æ¯åŒ…å«äº† 3 ä¸ªéƒ¨ä»½ï¼Œä½†åªæœ‰ 2ï¼Œ3 éƒ¨ä»½æœ‰è¿‡æœŸä¿¡æ¯ï¼Œä¸”å‡æ²¡è¿‡æœŸã€‚æ›´ç¦»è°±çš„æ˜¯ï¼Œæˆ‘ä¹ŸæŸ¥äº† Mojave çš„è¯ä¹¦ä¿¡æ¯ï¼Œå’Œä¸Šé¢çš„ High Sierra æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚

é‚£åˆ°åº•æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿåæ¥æˆ‘å‘ç°å¯ä»¥ä½¿ç”¨ `codesign` æŸ¥çœ‹æ›´è¯¦ç»†çš„è¯ä¹¦ä¿¡æ¯ã€‚

```bash {frame="none"}
codesign --display --extract-certificates Install\ macOS\ High\ Sierra.app
```

è¿™ä¸ªå‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ 3 ä¸ªè¯ä¹¦æ–‡ä»¶ã€‚

```bash {frame="none"}
codesign0 codesign1 codesign2
```

å†ä½¿ç”¨ `qlmanage` å‘½ä»¤æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ã€‚

```bash {frame="none"}
qlmanage -c public.x509-certificate -p codesign0
```

![software-signing](/images/misc/software-signing.png)

å¯ä»¥çœ‹åˆ° Software Signing çš„è¿‡æœŸæ—¶é—´æ˜¯ 2021 å¹´ 4 æœˆ 13 æ—¥ï¼Œä¹Ÿæ­£æ˜¯ä¸Šé¢ `pkgutil` ç¬¬ä¸€éƒ¨ä»½æ‰€ç¼ºå¤±çš„ä¿¡æ¯ã€‚å½“æˆ‘ä»¥ä¸ºçœŸç›¸å¤§ç™½çš„æ—¶å€™ï¼ŒåŒæ ·çš„å‘½ä»¤ï¼ŒMojave ä¹Ÿçš„è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯ 2021 å¹´ 4 æœˆ 13 æ—¥ï¼Œè¿™æˆ‘å°±ä¸æ‡‚äº†ï¼Œé‚£åº”è¯¥ä¸¤ä¸ªå®‰è£…åŒ…éƒ½ä¸è¡Œæ‰å¯¹å§ï¼Œç„¶åæˆ‘åˆé—®äº†ä¸€ä¸‹ ChatGPTã€‚

> ğŸ¤¡ï¼šä¸ºä»€ä¹ˆ macos çš„å®‰è£…ç¨‹åºä¸­ Software Signing è¯ä¹¦è¿‡æœŸï¼Œè¿˜èƒ½æ­£å¸¸è¿è¡Œ
>
> ğŸ¤–ï¼šåœ¨ macOS ä¸­ï¼Œå®‰è£…ç¨‹åºä¸­çš„ Software Signing è¯ä¹¦è¿‡æœŸåä¾ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„åŸå› æ˜¯å› ä¸ºç³»ç»Ÿçš„è®¾è®¡æ–¹å¼ã€‚åœ¨åˆ›å»ºå®‰è£…ç¨‹åºæ—¶ï¼Œåªè¦è¯ä¹¦åœ¨ç­¾ç½²æ—¶æ˜¯æœ‰æ•ˆçš„ï¼ŒmacOS ä¼šå¿½ç•¥è¯ä¹¦çš„è¿‡æœŸæ—¥æœŸï¼Œä»è€Œå…è®¸å·²ç­¾ç½²çš„åº”ç”¨ç¨‹åºç»§ç»­è¿è¡Œã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› ï¼š
>
> 1. **ç­¾ç½²æ—¶çš„æœ‰æ•ˆæ€§**ï¼šåœ¨å®‰è£…ç¨‹åºåˆ›å»ºæ—¶ï¼Œåªè¦è¯ä¹¦æ˜¯æœ‰æ•ˆçš„ï¼Œç­¾ç½²è¿‡ç¨‹å°±ä¼šæˆåŠŸå®Œæˆã€‚è¿™æ„å‘³ç€å®‰è£…ç¨‹åºåœ¨åˆ›å»ºæ—¶å·²ç»è¢«è®¤è¯ä¸ºå®‰å…¨çš„ï¼Œå³ä½¿ä¹‹åè¯ä¹¦è¿‡æœŸï¼Œç³»ç»Ÿä¾ç„¶è®¤å¯è¯¥ç­¾ç½²çš„åˆæ³•æ€§ã€‚
> 2. **ç³»ç»Ÿè®¾è®¡**ï¼šmacOS çš„è®¾è®¡ç†å¿µæ˜¯ä¸ºäº†ç¡®ä¿åº”ç”¨ç¨‹åºçš„è¿ç»­æ€§å’Œç”¨æˆ·ä½“éªŒçš„ç¨³å®šæ€§ã€‚ä¸ºäº†é¿å…å› è¯ä¹¦è¿‡æœŸè€Œå¯¼è‡´ç”¨æˆ·æ— æ³•ä½¿ç”¨å·²å®‰è£…çš„åº”ç”¨ç¨‹åºï¼ŒmacOS åœ¨è¿è¡Œæ—¶ä¼šå¿½ç•¥å·²ç­¾ç½²åº”ç”¨ç¨‹åºçš„è¯ä¹¦è¿‡æœŸé—®é¢˜ã€‚
> 3. **å‡å°‘ç”¨æˆ·å’Œå¼€å‘è€…çš„è´Ÿæ‹…**ï¼šå¦‚æœæ¯æ¬¡è¯ä¹¦è¿‡æœŸéƒ½è¦æ±‚ç”¨æˆ·é‡æ–°å®‰è£…åº”ç”¨ç¨‹åºï¼Œæˆ–è€…å¼€å‘è€…å¿…é¡»é¢‘ç¹æ›´æ–°è¯ä¹¦ï¼Œè¿™å°†ç»™ç”¨æˆ·å’Œå¼€å‘è€…å¸¦æ¥æå¤§çš„ä¸ä¾¿ã€‚å¿½ç•¥è¿‡æœŸè¯ä¹¦å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤ŸæŒç»­ä½¿ç”¨ä»–ä»¬ä¾èµ–çš„åº”ç”¨ç¨‹åºã€‚
> 4. **å®é™…æ“ä½œä¸­çš„å®¹é”™æ€§**ï¼šè™½ç„¶ç†è®ºä¸Šè¯ä¹¦æœ‰æœ‰æ•ˆæœŸï¼Œä½†å®é™…æ“ä½œä¸­ï¼ŒmacOS çš„å®¹é”™æ€§è®¾è®¡å…è®¸è¿‡æœŸè¯ä¹¦ç­¾ç½²çš„åº”ç”¨ç¨‹åºç»§ç»­è¿è¡Œã€‚è¿™ç§è®¾è®¡æ˜¯ä¸ºäº†ç¡®ä¿ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯é æ€§ã€‚
>
> ç»¼ä¸Šæ‰€è¿°ï¼ŒmacOS çš„å®‰è£…ç¨‹åºä¸­ï¼ŒSoftware Signing è¯ä¹¦è¿‡æœŸåä¾ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œæ˜¯ç”±äºç³»ç»Ÿåœ¨ç­¾ç½²æ—¶éªŒè¯æœ‰æ•ˆæ€§ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å¿½ç•¥è¯ä¹¦è¿‡æœŸæ—¥æœŸï¼Œä»è€Œç¡®ä¿åº”ç”¨ç¨‹åºçš„è¿ç»­æ€§å’Œç”¨æˆ·ä½“éªŒçš„ç¨³å®šæ€§ã€‚

æ‰€ä»¥åˆ°è¿™é‡Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è®¤ä¸ºä¸¤ä¸ªå®‰è£…åŒ…çš„è¯ä¹¦éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Ÿ

### Apple Installer Checksums

ä¼¼ä¹æˆ‘ä»¬è¿˜å¯ä»¥éªŒè¯ä¸€ä¸‹å®‰è£…åŒ…çš„å®Œæ•´æ€§ï¼Œ[Mac OSX Installers SHA1 Checksums](https://github.com/notpeter/apple-installer-checksums)ã€‚

```bash {frame="none"}
shasum /Applications/Install*OS*.app/Contents/SharedSupport/{Base,Install}*.dmg
```

ä½†æˆ‘éƒ½è¯•äº†ï¼Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¹Ÿä»£è¡¨ä¸äº†ä»€ä¹ˆã€‚

### çœŸç›¸åˆ°åº•æ˜¯ä»€ä¹ˆ

> It doesn't workï¼Œbut I don't know why.

äº‹æƒ…å‘å±•åˆ°è¿™é‡Œï¼Œæˆ‘å·²ç»ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´ High Sierra å®‰è£…åŒ…æŠ¥é”™äº†ã€‚

## å‚è€ƒ

* [https://eclecticlight.co/2019/10/18/beware-apple-security-certificates-after-24-october-they-may-have-expired/](https://eclecticlight.co/2019/10/18/beware-apple-security-certificates-after-24-october-they-may-have-expired/)
* [https://www.youtube.com/watch?v=E4Mu4tI8-iw](https://www.youtube.com/watch?v=E4Mu4tI8-iw)
* [https://github.com/notpeter/apple-installer-checksums](https://github.com/notpeter/apple-installer-checksums)
